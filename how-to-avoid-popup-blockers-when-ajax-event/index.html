<!DOCTYPE html><html class="kud-Status--post"><head><meta charset="utf-8"/><title>_kud.diary — How to avoid popup blockers when ajax + event</title><meta name="description" content="Diary of the _kud"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" type="image/png" href="http://kud.io/favicon.png"/><link href="http://fonts.googleapis.com/css?family=Montserrat|Lato|Raleway:400,800,300" rel="stylesheet" type="text/css"/><link href="http://yandex.st/highlightjs/8.0/styles/default.min.css" rel="stylesheet" type="text/css"/><link rel="stylesheet" href="/index.css"/></head><body><div class="kud-Wrapper"><div class="kud-Header "><a href="/" class="kud-Header-avatar"><img src="http://www.gravatar.com/avatar/e6eaeaa6da69e804c27c2d4cd55107e0?s=500"/></a><h1 class="kud-Header-heading">Diary of the _kud</h1></div><section class="kud-Post kud-BeautifyLink animated fadeIn"><div class="kud-PostHeader"><img src="http://media.giphy.com/media/JdDnwsVcpa1B6/giphy.gif" class="kud-PostHeader-img"><div class="kud-PostHeader-overlay"><div class="kud-PostHeader-wrapper"><h2 class="kud-PostHeader-heading">How to avoid popup blockers when ajax + event</h2><time class="kud-PostHeader-date">Friday 3rd April 2015</time></div></div></div><div class="kud-Post-content"><p>Hey there,</p>
<p>Today, I’ll give you a little trick to avoid the popup blocker on browsers when you do an http request between your user event and opening the popup.</p>
<p>You know how to open a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/open">popup</a>, it’s quite simple:</p>
<pre><code class="hljs javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">window</span>.open( strUrl, strWindowName, strWindowFeatures )
})</code></pre>

<p>Now, you want to open it when the user clicks on your button:</p>
<pre><code class="hljs javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.kud-js-MyButton'</span>).addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-built_in">window</span>.open( strUrl, strWindowName, strWindowFeatures )
    })
})</code></pre>

<p>But before opening the popup, you maybe want to get some informations from the backend by doing an ajax request:</p>
<p>(to ease the code, I use <a href="https://github.com/bloodyowl/request">bloody-request</a>)</p>
<pre><code class="hljs javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.kud-js-MyButton'</span>).addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{

      bloodyRequest.get( url )
        .then(
          <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span> <span class="hljs-params">( res )</span> </span>{
            <span class="hljs-built_in">window</span>.open( res.url , strWindowName, strWindowFeatures )
          },
          <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">error</span><span class="hljs-params">()</span> </span>{}
        )
    })
})</code></pre>

<p>This is where you’re doing it wrong.</p>
<p>Indeed, because you make an ajax request between the event and the final “window.open”, the browser will cry and blocks your popup.</p>
<p>The solution is to make the popup first and to change its location just after. Like that:</p>
<pre><code class="hljs javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.kud-js-MyButton'</span>).addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{

      <span class="hljs-keyword">var</span> popup = <span class="hljs-built_in">window</span>.open( strUrl, strWindowName, strWindowFeatures )

      bloodyRequest.get( url )
        .then(
          <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span> <span class="hljs-params">( res )</span> </span>{
            popup.location = res.url
          },
          <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">error</span><span class="hljs-params">()</span> </span>{
            popup.close()
          }
        )
    })
})</code></pre>

<p>Now, you’ll be able to start your popup and use the result of your request ajax to adjust it.</p>
<p>Enjoy.</p>
</div></section><div class="kud-Footer kud-BeautifyLink"><ul class="kud-Footer-list"><li class="kud-Footer-listItem"><a href="http://kud.io">La Maison</a></li><li class="kud-Footer-listItem"><a href="http://instagram.kud.io">Le Instagram</a></li><li class="kud-Footer-listItem"><a href="http://twitter.kud.io">Le Twitter</a></li></ul></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-25156890-8', 'auto');
ga('send', 'pageview');</script></body></html>